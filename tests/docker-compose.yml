version: '3.2'

services:

  dab:
    build:
      context: ../
      dockerfile: Dockerfile
    image: nekroze/dab:latest

  tests:
    image: 'nekroze/containaruba:alpine'
    environment:
      DAB_AUTOUPDATE: 'no'
      DAB_WRAPPER_PATH: "${PWD}/dab"
    volumes:
      - ./features:/usr/src/app/features
      - ../dab:/usr/bin/dab
    command:
      - '--order=random'
    tty: true
    stdin_open: true

  build:
    image: docker/compose:1.22.0
    command: build --force-rm --pull dab
    working_dir: /opt/dab/tests
    volumes:
      - ../:/opt/dab:ro

version: '3.2'

services:

  dab:
    build:
      context: ../
      dockerfile: Dockerfile
    image: nekroze/dab:latest

  test:
    image: nekroze/containaruba:latest
    environment:
      DAB_REPO_PATH: /tmp/dab/repos
      DAB_CONF_PATH: /tmp/dab/config
      DAB_DEV_MOUNT: 'no'
      DAB_AUTOUPDATE: 'no'
      DAB_UID: '0'
      DAB_GID: '0'
      DAB_WRAPPER_PATH: "${PWD}/dab"
      DAB_LAB_NAME: 'testlab'
      DAB_COMPOSE_PREFIX: 'test'
    user: '0:0'
    command:
      - --order=random
    volumes:
      - ./features:/usr/src/app/features
      - /etc/group:/etc/group:ro
      - /var/run/docker.sock:/var/run/docker.sock
      - /tmp/dab:/tmp/dab
      - ../dab:/bin/dab

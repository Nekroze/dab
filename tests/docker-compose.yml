version: '3.2'

services:

  dab:
    build:
      context: ../
      dockerfile: Dockerfile
      cache_from:
        - alpine:latest
        - nekroze/dab:latest
    image: nekroze/dab:latest

  test:
    image: nekroze/containaruba:latest
    environment:
      DAB_REPO_PATH: /tmp/dab/repos
      DAB_CONF_PATH: /tmp/dab/config
      DAB_DEV_MOUNT: 'no'
      DAB_AUTOUPDATE: 'no'
      DAB_UID: '0'
      DAB_GID: '0'
    user: '0:0'
    volumes:
      - ./features:/usr/src/app/features
      - /etc/group:/etc/group:ro
      - /var/run/docker.sock:/var/run/docker.sock
      - /tmp/dab:/tmp/dab
      - ../dab:/usr/src/app/dab:ro
      - ../dab:/bin/dab:ro
